stages:
  - test
  - name: deploy
    if: tag =~ ^v0\.

jobs:
  include:
  - stage: test
    language: java
    jdk: oraclejdk8
    script:
    - travis_wait 45 ./gradlew check

  - stage: deploy
    language: python
    python: 3.6
    before_install:
    - cd docs
    script:
    - make html
    before_deploy:
    - sphinx-versioning build docs build/html -r v0.511 -w "nobranch"
    - touch build/html/.nojekyll
    deploy:
      provider: pages
      skip-cleanup: true
      github-token: ${GITHUB_TOKEN}
      keep-history: true
      repo: knewjade/sfinder-manual
      local-dir: docs/build/html/
      target-branch: master
